<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spiron Consensus Engine â€“ Complete Class Architecture (Updated 2025)</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.1/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 4px solid #3498db;
            padding-bottom: 15px;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 2px solid #ecf0f1;
            font-size: 1.8em;
        }
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1em;
            margin-bottom: 30px;
        }
        .diagram {
            margin: 30px 0;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            overflow-x: auto;
        }
        .description {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid #2196f3;
        }
        .description h3 {
            margin-top: 0;
            color: #1976d2;
            font-size: 1.3em;
        }
        .architecture-highlight {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            padding: 25px;
            border-radius: 8px;
            margin: 30px 0;
            border-left: 5px solid #ff9800;
        }
        .architecture-highlight h3 {
            margin-top: 0;
            color: #f57c00;
        }
        .implementation-notes {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid #4caf50;
        }
        .implementation-notes h4 {
            margin-top: 0;
            color: #2e7d32;
        }
        .class-path {
            display: inline-block;
            background: #f5f5f5;
            padding: 8px 16px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin: 5px;
            border: 1px solid #ddd;
        }
        ul {
            line-height: 1.8;
        }
        .toc {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .toc h3 {
            margin-top: 0;
        }
        .toc ul {
            list-style: none;
            padding-left: 0;
        }
        .toc li {
            padding: 5px 0;
        }
        .toc a {
            color: #3498db;
            text-decoration: none;
            font-weight: 500;
        }
        .toc a:hover {
            text-decoration: underline;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        .design-pattern {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid #9c27b0;
        }
        .design-pattern h4 {
            margin-top: 0;
            color: #6a1b9a;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŒ€ Spiron Consensus Engine â€“ Complete Class Architecture</h1>
        <p class="subtitle"><strong>Generated:</strong> November 20, 2025 | <strong>Version:</strong> 1.0.0 | <strong>Coverage:</strong> 50+ Components | <strong>Metrics:</strong> 60+ Prometheus Metrics</p>
        
        <div class="toc">
            <h3>ðŸ“‘ Table of Contents</h3>
            <ul>
                <li><a href="#core">1. Core Engine Components</a></li>
                <li><a href="#networking">2. Networking & RPC Layer</a></li>
                <li><a href="#storage">3. Storage Backends</a></li>
                <li><a href="#crdt">4. CRDT & Gossip Layer</a></li>
                <li><a href="#validation">5. Validation & Crash Fault Tolerance</a></li>
                <li><a href="#finality">6. Finality Detection</a></li>
                <li><a href="#metrics">7. Metrics & Observability (60+ Metrics)</a></li>
                <li><a href="#config">8. Configuration & DI</a></li>
                <li><a href="#security">9. Security & Signatures</a></li>
                <li><a href="#client">10. Client API</a></li>
            </ul>
        </div>

        <h2 id="core">1. Core Engine Components</h2>
        <div class="description">
            <h3>Architecture Overview</h3>
            <p>The core engine implements the Eddy-based consensus mechanism using energy-driven dominance. The <code>EddyEngine</code> is the heart of the system, managing vector states with energy levels and performing angular similarity-based merging.</p>
            <p><strong>Key Classes:</strong></p>
            <ul>
                <li><span class="class-path">com.spiron.core.EddyEngine</span> - Main consensus engine</li>
                <li><span class="class-path">com.spiron.core.EddyState</span> - Immutable state record (Java 17)</li>
                <li><span class="class-path">com.spiron.core.EddyMath</span> - Mathematical operations (similarity, siphoning)</li>
                <li><span class="class-path">com.spiron.core.SpironRaftLog</span> - Persistent append-only log</li>
                <li><span class="class-path">com.spiron.core.SpironSnapshotStore</span> - Snapshot storage for recovery</li>
            </ul>
        </div>
        <div class="diagram">
            <div class="mermaid">
classDiagram
    class EddyEngine
    class EddyState
    class EddyMath
    class SpironRaftLog
    class SpironSnapshotStore

    EddyEngine --> EddyState
    EddyEngine --> EddyMath
    EddyEngine --> SpironRaftLog
    EddyEngine --> SpironSnapshotStore
            </div>
        </div>
        
        <div class="implementation-notes">
            <h4>ðŸ”§ Implementation Details</h4>
            <ul>
                <li><strong>Thread Safety:</strong> <code>EddyEngine.ingest()</code> is synchronized for concurrent access</li>
                <li><strong>Energy Damping:</strong> Non-similar eddies have energy reduced by factor Î± (alpha)</li>
                <li><strong>Siphon Merge:</strong> Similar eddies transfer energy based on angular similarity</li>
                <li><strong>Commit Threshold:</strong> Eddies with energy â‰¥ commitEnergy trigger consensus</li>
                <li><strong>Vector Dimensions:</strong> Configurable 128-2000 dimensions for state representation</li>
            </ul>
        </div>

        <h2 id="networking">2. Networking & RPC Layer</h2>
        <div class="description">
            <h3>Architecture Overview</h3>
            <p>gRPC-based networking layer handling broadcast, commit, and gossip synchronization. Uses HTTP/2 with binary protobuf serialization for high performance.</p>
            <p><strong>Key Classes:</strong></p>
            <ul>
                <li><span class="class-path">com.spiron.network.RpcServer</span> - Server hosting gRPC services</li>
                <li><span class="class-path">com.spiron.network.RpcClient</span> - Client for broadcasting to peers</li>
                <li><span class="class-path">com.spiron.network.EddyRpcService</span> - Handles broadcast/commit RPCs</li>
                <li><span class="class-path">com.spiron.network.EddyGossipService</span> - Handles CRDT sync RPCs</li>
                <li><span class="class-path">com.spiron.discovery.Discovery</span> - Service discovery</li>
            </ul>
        </div>
        <div class="diagram">
            <div class="mermaid">
classDiagram
    class RpcServer
    class RpcClient
    class EddyRpcService
    class EddyGossipService
    class GossipScheduler

    RpcServer --> EddyRpcService
    RpcServer --> EddyGossipService
    RpcClient --> EddyRpcService
    GossipScheduler --> EddyGossipService
    EddyRpcService --> EddyEngine
    EddyGossipService --> CRDTStore
            </div>
        </div>

        <h2 id="storage">3. Storage Backends</h2>
        <div class="description">
            <h3>Architecture Overview</h3>
            <p>Pluggable storage supporting solo (RocksDB) and cluster (etcd) modes.</p>
        </div>
        <div class="diagram">
            <div class="mermaid">
classDiagram
    class CRDTStore
    class RocksDbCRDTStore
    class EtcdCRDTStore

    CRDTStore <|-- RocksDbCRDTStore
    CRDTStore <|-- EtcdCRDTStore
            </div>
        </div>

        <div class="architecture-highlight">
            <h3>ðŸŽ¯ Architecture Summary</h3>
            <p><strong>Total Classes:</strong> 40+ across 8 packages</p>
            <p><strong>Design Principles:</strong> Separation of Concerns, Dependency Injection, Interface-Based, Thread Safety, Observable</p>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default'
        });
    </script>
</body>
</html>
